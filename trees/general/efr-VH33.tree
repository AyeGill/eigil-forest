\date{2025-10-30T09:47:16Z}
\author{eigil-rischel}
\import{macros}
\taxon{Lemma}
\p{
  Let #{F: \Borel \to \cC} be .. Then there is a unique Markov extension #{\bar{F}} over #{\Borel \to \Borel_{\Delta_\omega}}.
}
\proof{
  \p{
    First, note that the Kleisli category #{\Borel_{\Delta_\omega}} is freely generated by adding morphisms #{s_A: \Delta_\omega A \to A} for each #{A}, subject to the equations that these are natural in #{A}, unital for the monad structure, and satisfy #{s_A\mu_A = s_As_{\Delta_\omega}A} (where #{\mu} is the multiplication of the monad).
  }
  \p{
    Let #{\Delta_omega (\omega) \to \omega} be the map in #{\cC} constructed above. We first prove that the resulting #{F(A)^\omega \times \Delta_\omega(\omega) \to F(A)} factors over #{F(\Delta_\omega A)}. This factorization will be our chosen #{\bar{F}(s_A)}.
  }
  \p{
    Note that the map #{F(A)^\omega \times \Delta_\omega(\omega) \to F(\Delta_\omega A)} is #{F} applied to a map #{A^\omega \times \Delta_\omega \omega \to \Delta_\omega A}. This map splits. As above, to show the sampling map factors over this, it suffices to describe the normal form implied by the splitting and show that normalizing first does not alter the sampling map. It is easier here to simply describe the normal form:
  }
  \ol{
    \li{
      If any #{a \in A} occurs multiple times with nonzero #{\epsilon_i}, combine all of them (replacing those #{\epsilon_i} with zero and adding them to the coefficient of the first occurence of that #{a})
    }
    \li{
      Fix some arbitrary #{a^* \in A} and set #{a_i = a^*} whenever #{\epsilon_i = 0}.
    }
    \p{
      Permute both the coefficients and the #{a_i}, ordering first by decreasing #{\epsilon_i}, then by some arbitrary total order on #{A} (note that the set of distinct #{a_i} with the same coefficient must be finite, so this can be done for any total order).
    }
  }
  \p{
    It's clear that the normal forms are in bijection with #{\Delta_\omega A}. Just as above, we can prove that sampling and normalization followed by sampling agree by identifying fifty percept of the probability mass of the normalized thing, then fifty percent of the rest, etc. 
  }
  \p{
    As we have shown above, the map #{F(X)^\omega \times \Delta_\omega(\omega) \to F(X)} always factors uniquely over #{F(\Delta_\omega X)}. We take this factorization to be #{\bar{F}(s_X)}. 
  }
  \p{
    It's clear that this is unital. We now pass to the multiplicativity. Note that the map #{F(X)^\omega \times \Delta_\omega(\omega) \to F(X)} is natural for \em{any} map #{F(X) \to F(Y) \in \cC}. Consider this diagram:
  }
  \quiver{
    % https://q.uiver.app/#q=WzAsOSxbMSwyLCJGKFxcRGVsdGFfXFxvbWVnYV4yKFgpKSJdLFswLDMsIkYoXFxEZWx0YV9cXG9tZWdhKFgpKSJdLFsxLDQsIkYoWCkiXSxbMiwzLCJGKFxcRGVsdGFfXFxvbWVnYShYKSkiXSxbMSwxLCJGKChYXlxcb21lZ2FcXHRpbWVzIFxcRGVsdGFfXFxvbWVnYShcXG9tZWdhKSleXFxvbWVnYSBcXHRpbWVzIFxcRGVsdGFfXFxvbWVnYShcXG9tZWdhKSkiXSxbMCwyLCJGKFheXFxvbWVnYVxcdGltZXMgXFxEZWx0YV9cXG9tZWdhKFxcb21lZ2EpKSJdLFsxLDAsIkYoWF57XFxvbWVnYSBcXHRpbWVzIFxcb21lZ2F9XFx0aW1lcyBcXERlbHRhX1xcb21lZ2EoXFxvbWVnYSleXFxvbWVnYVxcdGltZXNcXERlbHRhX1xcb21lZ2EoXFxvbWVnYSkpIl0sWzAsMSwiRihYXntcXG9tZWdhIFxcdGltZXMgXFxvbWVnYX0gXFx0aW1lcyBcXERlbHRhX1xcb21lZ2EoXFxvbWVnYSBcXHRpbWVzIFxcb21lZ2EpKSJdLFszLDIsIkYoWF5cXG9tZWdhIFxcdGltZXMgXFxEZWx0YV9cXG9tZWdhKFxcb21lZ2EpKSJdLFswLDEsIkYoXFxtdV9YKSIsMl0sWzEsMiwiXFxiYXJ7Rn0oc19YKSIsMl0sWzAsMywiXFxiYXJ7Rn0oc197XFxEZWx0YV9cXG9tZWdhKFgpfSkiXSxbMywyLCJcXGJhcntGfShzX1gpIl0sWzQsMCwiIiwyLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzUsMSwiIiwwLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzYsNCwiXFxzaW0iLDAseyJsYWJlbF9wb3NpdGlvbiI6NDB9XSxbNiw3XSxbNyw1LCJcXHNpbSIsMl0sWzQsOCwiKHNeXFxvbWVnYSkiLDJdLFs4LDIsIiIsMix7ImN1cnZlIjotNX1dXQ==
\begin{tikzcd}
	& {F(X^{\omega \times \omega}\times \Delta_\omega(\omega)^\omega\times\Delta_\omega(\omega))} \\
	{F(X^{\omega \times \omega} \times \Delta_\omega(\omega \times \omega))} & {F((X^\omega\times \Delta_\omega(\omega))^\omega \times \Delta_\omega(\omega))} \\
	{F(X^\omega\times \Delta_\omega(\omega))} & {F(\Delta_\omega^2(X))} && {F(X^\omega \times \Delta_\omega(\omega))} \\
	{F(\Delta_\omega(X))} && {F(\Delta_\omega(X))} \\
	& {F(X)}
	\arrow[from=1-2, to=2-1]
	\arrow["\sim"{pos=0.4}, from=1-2, to=2-2]
	\arrow["\sim"', from=2-1, to=3-1]
	\arrow[two heads, from=2-2, to=3-2]
	\arrow["{(s^\omega)}"', from=2-2, to=3-4]
	\arrow[two heads, from=3-1, to=4-1]
	\arrow["{F(\mu_X)}"', from=3-2, to=4-1]
	\arrow["{\bar{F}(s_{\Delta_\omega(X)})}", from=3-2, to=4-3]
	\arrow[curve={height=-30pt}, from=3-4, to=5-2]
	\arrow["{\bar{F}(s_X)}"', from=4-1, to=5-2]
	\arrow["{\bar{F}(s_X)}", from=4-3, to=5-2]
\end{tikzcd}
  }
  \p{
    The object is to show that the bottom square commutes. It suffices to consider the two composites from the top object. First consider the right side. By naturality, the outer cell commutes. The map from the top is given by sampling from all the #{\Delta_\omega}, using the coordinate of the second one to index into the sequence #{\Delta_\omega(\omega)^\omega}, then taking #{x_{ij}} where #{i,j} are the resulting two natural numbers.
  }
  \p{
    Now consider the left side. The map labeled #{\mu'} is given by forming the joint distribution on #{\omega \times \omega} obtained by ... The top left cell is simply #{F} applied to a map in #{\Borel}, which is easily seen to commute. 
  }
  \p{
    Thus it suffices to show that the two maps #{F(\Delta_\omega(\omega)^\omega \times \Delta_\omega(\omega)) \to F(\omega \times \omega)} given either by using this mutiplication in #{\Borel}, then sampling, or by sampling from everything and combining, agree. But this is essentially the claim that the sampling map is a (infinitary) midpoint homomorphism.
  }
  \todo{Either here or elsewhere, need to insert this}
}
